<main class="main">
  <header class="header">
    <h1>Ledger AI</h1>
    <p>Upload your bank statement to analyze spending and income categories</p>
  </header>

  @if (!result()) {
    <div
      class="upload-zone"
      [class.dragging]="dragging()"
      (dragover)="onDragOver($event)"
      (dragleave)="onDragLeave($event)"
      (drop)="onDrop($event)"
    >
      @if (!selectedFile()) {
        <div class="upload-prompt">
          <svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 -960 960 960" width="48" fill="currentColor">
            <path d="M440-367v-213l-76 76-43-43 149-149 149 149-43 43-76-76v213h-60ZM220-160q-24 0-42-18t-18-42v-143h60v143h520v-143h60v143q0 24-18 42t-42 18H220ZM160-554v-246q0-24 18-42t42-18h280l200 200v106h-60v-76H480v-154H220v230h-60Z"/>
          </svg>
          <p>Drag and drop your bank statement PDF here</p>
          <span class="or">or</span>
          <label class="file-btn">
            Browse Files
            <input type="file" accept=".pdf" (change)="onFileSelected($event)" hidden />
          </label>
        </div>
      } @else {
        <div class="file-selected">
          <svg xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 -960 960 960" width="32" fill="currentColor">
            <path d="M319-250h322v-60H319v60Zm0-170h322v-60H319v60ZM220-80q-24 0-42-18t-18-42v-680q0-24 18-42t42-18h361l219 219v521q0 24-18 42t-42 18H220Zm331-554v-186H220v680h520v-494H551ZM220-820v186-186 680-680Z"/>
          </svg>
          <span class="file-name">{{ selectedFile()!.name }}</span>
          <button class="remove-btn" (click)="reset()">Remove</button>
        </div>
      }
    </div>

    @if (error()) {
      <p class="error">{{ error() }}</p>
    }

    <button
      class="analyze-btn"
      [disabled]="!selectedFile() || loading()"
      (click)="analyze()"
    >
      @if (loading()) {
        <span class="spinner"></span>
        Analyzing...
      } @else {
        Analyze Statement
      }
    </button>
  } @else {
    <div class="results">
      <div class="summary">
        <div class="summary-card income">
          <span class="summary-label">Total Income</span>
          <span class="summary-value">{{ result()!.total_income | currency }}</span>
        </div>
        <div class="summary-card expense">
          <span class="summary-label">Total Expenses</span>
          <span class="summary-value">{{ result()!.total_expenses | currency }}</span>
        </div>
        <div class="summary-card net">
          <span class="summary-label">Net</span>
          <span class="summary-value">{{ result()!.total_income - result()!.total_expenses | currency }}</span>
        </div>
      </div>

      <div class="categories">
        @for (category of result()!.categories; track category.name) {
          <div class="category-card" [class.income]="category.type === 'income'" [class.expense]="category.type === 'expense'">
            <div class="category-header">
              <h3>{{ category.name }}</h3>
              <span class="category-total" [class.income]="category.type === 'income'" [class.expense]="category.type === 'expense'">
                {{ category.total | currency }}
              </span>
            </div>
            <div class="transactions">
              @for (tx of category.transactions; track $index) {
                <div class="transaction">
                  <span class="tx-date">{{ tx.date }}</span>
                  <span class="tx-desc">{{ tx.description }}</span>
                  <span class="tx-amount">{{ tx.amount | currency }}</span>
                </div>
              }
            </div>
          </div>
        }
      </div>

      <button class="analyze-btn" (click)="reset()">Upload Another Statement</button>
    </div>
  }
</main>
